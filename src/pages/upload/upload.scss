@import "../../styles/responsive.scss";

:root {
  --paper: #fff;
  --ink: #0f172a;
  --ink-dim: #475569;
  --line: #e2e8f0;
  --chip-bg: #f1f5f9;
  --chip-ink: #334155;
  --accent: #7c5cff;
  --accent2: #4cc9f0;

  --ok1: #34d399; --ok2: #16a34a;
  --warn1: #f59e0b; --warn2: #fb7185;
  --bad1: #fb7185; --bad2: #ef4444;

  /* Controls */
  --zoom: 1;          /* 0.75 to 1.5 range recommended */
  --rowH: 40px;       /* row height control */
}

/* Uses your existing CSS vars:
   --paper, --ink, --line, --accent, --ok1/2, --warn1/2, --bad1/2, etc. */

.upload-page {
  height: 100dvh;                 /* mobile-safe viewport */
  padding: 12px;
  background: var(--paper);
  color: var(--ink);
}

/* main card */
.upload-page .paper {
  background: var(--paper);
  border: 1px solid var(--line);
  border-radius: 14px;
  overflow: hidden;               /* contain sticky headers shadow */
  display: flex;
  flex-direction: column;
  min-height: calc(100dvh - 24px); /* page padding (12*2) */
}

/* ===== top toolbar ===== */
.table-toolbar {
  position: sticky;
  top: 0;
  z-index: 3;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: calc(10px + env(safe-area-inset-top)) 12px 10px 12px;
  background: color-mix(in oklab, var(--paper) 85%, #000 15%);
  backdrop-filter: blur(8px);
  border-bottom: 1px solid var(--line);
  box-shadow: 0 1px 0 rgba(0,0,0,.02);

  .title {
    font-weight: 700;
    font-size: 15px;
    letter-spacing: .2px;
  }

  .divider {
    width: 1px;
    height: 22px;
    background: var(--line);
    margin: 0 4px;
  }

  .search {
    min-width: 140px;
  }
  .search input {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid var(--line);
    border-radius: 10px;
    background: var(--paper);
    color: var(--ink);
    font-size: 14px;
  }
}

/* solid “pill” buttons matching your chips */
.gbtn {
  border: 1px solid var(--line);
  background: var(--chip-bg, #f1f5f9);
  color: var(--chip-ink, #334155);
  border-radius: 999px;
  padding: 8px 12px;
  font-weight: 600;
  font-size: 13px;
}
.gbtn.ghost { background: transparent; }
.gbtn.ok   { background: var(--ok1);  color: #071b10; border-color: transparent; }
.gbtn.warn { background: var(--warn1); color: #1b1007; border-color: transparent; }
.gbtn.bad  { background: var(--bad1); color: #1b0707; border-color: transparent; }

/* ===== second control row ===== */
.table-controls {
  position: sticky;
  top: calc(52px + env(safe-area-inset-top)); /* sits under toolbar on mobile */
  z-index: 2;
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 10px 12px;
  padding: 10px 12px;
  background: var(--paper);
  border-bottom: 1px solid var(--line);

  .ctl {
    display: inline-flex; align-items: center; gap: 8px;
    font-size: 12px; color: var(--ink-dim, #475569);
  }
  .ctl input[type="range"] { width: 120px; }
  .col-visibility { display: inline-flex; flex-wrap: wrap; gap: 6px; }
  .chip {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 6px 10px; border-radius: 999px;
    background: var(--chip-bg); color: var(--chip-ink);
    font-size: 12px;
    border: 1px solid var(--line);
  }
  .chip input { accent-color: var(--accent); }
  .muted { color: var(--ink-dim); }
}

/* ===== filters tray ===== */
.filters {
  display: grid;
  grid-template-columns: repeat(4, minmax(0,1fr));
  gap: 12px;
  padding: 12px;
  border-bottom: 1px solid var(--line);
  background: var(--paper);

  .field { display: grid; gap: 6px; }
  label { font-size: 12px; color: var(--ink-dim); }
  select {
    padding: 8px 10px; border: 1px solid var(--line);
    border-radius: 10px; background: var(--paper); color: var(--ink);
  }
}

/* ===== upload controls section ===== */
.upload-page .paper > div[style*="padding: 14px"] {
  padding: 12px;                  /* keep your existing wrapper but tighter on mobile */
}

/* ===== table ===== */
.table-wrap {
  --zoom: 1;
  --rowH: 40px;
  flex: 1 1 auto;
  overflow: auto;                 /* vertical scroll */
  -webkit-overflow-scrolling: touch;
  padding: 0 12px 16px 12px;
}

/* horizontal scroll on small screens */
@media (max-width: 900px) {
  .table-wrap { overflow: auto; }
  .table-wrap table { min-width: 720px; } /* prevent cramped columns */
}

.table-wrap table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  transform: scale(var(--zoom));
  transform-origin: top left;
}

thead th {
  position: sticky;
  top: calc(52px + 42px + env(safe-area-inset-top)); /* toolbar + controls */
  z-index: 1;
  background: var(--paper);
  border-bottom: 1px solid var(--line);
  text-align: left;
  padding: 10px;
  font-size: 12px;
  color: var(--ink-dim);
}
tbody td {
  padding: 10px;
  border-bottom: 1px solid var(--line);
  height: var(--rowH);
  font-size: 14px;
  color: var(--ink);
}

/* column resizer handle */
.resizer {
  position: absolute;
  right: -4px; top: 0; bottom: 0;
  width: 8px; cursor: col-resize; touch-action: none;
}

/* status pills (Fulfillment) */
.status { padding: 4px 8px; border-radius: 999px; font-weight: 600; font-size: 12px; }
.status.ok   { background: color-mix(in oklab, var(--ok1) 85%, white 15%);   color:#062a18; }
.status.warn { background: color-mix(in oklab, var(--warn1) 85%, white 15%); color:#2a1d06; }
.status.bad  { background: color-mix(in oklab, var(--bad1) 85%, white 15%);  color:#2a0606; }

/* ===== mobile stacking tweaks ===== */
@media (max-width: 640px) {
  .table-toolbar {
    flex-wrap: wrap;
    row-gap: 8px;
    .title { flex: 1 1 100%; font-size: 16px; }
    .divider { display: none; }
    .gbtn { padding: 8px 10px; font-size: 12px; }
    .search { flex: 1 1 100%; }
  }

  .table-controls {
    top: auto;                    /* let headers compute stickiness below */
    position: static;
    padding-top: 8px;
    .ctl input[type="range"] { width: 100px; }
  }

  .filters {
    grid-template-columns: 1fr 1fr;
  }

  thead th {                      /* recompute sticky top for small screens */
    top: calc(52px + env(safe-area-inset-top));  /* only top toolbar sticks */
  }
}
